import { ParseTree } from 'antlr4ts/tree/ParseTree';
import { ParseTreeVisitor } from 'antlr4ts/tree/ParseTreeVisitor';
import { Token } from 'antlr4ts/Token';
import { ParserRuleContext } from 'antlr4ts/ParserRuleContext';
import PortuguesPuroVisitor from './antlr/PortuguesPuroVisitor';
import {
    ProgramaContext,
    TipoContext,
    Variável_globalContext,
    RotinaContext,
    NomeContext,
    Regra_espaçoContext
} from './antlr/PortuguesPuroParser';

interface ASTNode {
    type: string;
    name?: string;
    line?: number;
    column?: number;
    file?: string;
    children?: ASTNode[];
}




export class ASTBuilder implements PortuguesPuroVisitor<ASTNode> {
  
  // propriedades visit 
  visit(node) {
    return node.accept(this);
  }
  visitChildren(node) {    
    return node.accept(this);
  }
  visitTerminal(node) {    
    return node.accept(this);
  }
  visitErrorNode(node) {    
    return node.accept(this);
  }
  visitRegra_espaço(contexto: Regra_espaçoContext): ASTNode {
        //const nomeCtx =  NomeContext;
        const regraToken = contexto.start;

        return {
            type: 'RegraEspaço',
            name: 'Regra de Espaço',
            // file: regraToken,
            //name: nomeCtx ? nomeCtx: undefined,
            //line: regraToken.line,
            //column: regraToken.charPositionInLine
        };
    }

    // Implement other visit methods for different contexts as needed
}

/*
    visitPrograma(ctx: ProgramaContext): ASTNode {
        const children: ASTNode[] = [];

        const tipoCtxList = ctx.tipo();
        
				// Visit each TipoContext and add to children				}
        
        for (const tipoCtx of tipoCtxList) {
            children.push(this.visit(tipoCtx as ParseTree));
        }

        const variavelCtxList = ctx.variável_global();
        for (const variavelCtx of variavelCtxList) {
            children.push(this.visit(variavelCtx as ParseTree));
        }

        const rotinaCtxList = ctx.rotina();
        for (const rotinaCtx of rotinaCtxList) {
            children.push(this.visit(rotinaCtx as ParseTree));
        }

        return {
            type: 'Programa',
            children
        };
    }

    visitTipo(ctx: TipoContext): ASTNode {
        const nomeCtxList = ctx.nome();
        const nomeCtx = nomeCtxList.length > 0 ? nomeCtxList[0] : undefined;
        const tipoToken = ctx.start as Token;

        return {
            type: 'Tipo',
            name: nomeCtx ? (nomeCtx as ParserRuleContext).getText() : undefined,
            line: tipoToken.line,
            column: tipoToken.charPositionInLine
        };
    }

    visitVariavel_global(ctx: Variavel_globalContext): ASTNode {
        const nomeCtxList = ctx.nome();
        const nomeCtx = nomeCtxList.length > 0 ? nomeCtxList[0] : undefined;
        const varToken = ctx.start as Token;

        return {
            type: 'VariavelGlobal',
            name: nomeCtx ? (nomeCtx as ParserRuleContext).getText() : undefined,
            line: varToken.line,
            column: varToken.charPositionInLine
        };
    }

    visitRotina(ctx: RotinaContext): ASTNode {
        const nomeDaRotinaCtx = ctx.nomeDaRotina();
        const rotinaToken = ctx.start as Token;

        return {
            type: 'Rotina',
            name: nomeDaRotinaCtx ? (nomeDaRotinaCtx as ParserRuleContext).getText() : undefined,
            line: rotinaToken.line,
            column: rotinaToken.charPositionInLine
        };
    }

    // Métodos padrão para o Visitor Interface
    visit(tree: ParseTree): ASTNode {
        return tree.accept(this);
    }

    visitChildren(node: ParseTree): ASTNode {
        return { type: 'UnknownNode' };
    }

    visitTerminal(node: ParseTree): ASTNode {
        return { type: 'TerminalNode' };
    }

    visitErrorNode(node: ParseTree): ASTNode {
        return { type: 'ErrorNode' };
    }*/
